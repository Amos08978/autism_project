{% extends "admin_base.html" %}
{% block content %}
<h2 class="mt-4">測試結果查詢</h2>

<form method="post" class="mb-4">
    <label class="form-label">選擇小朋友</label>
    <select name="child_name" class="form-select" required>
        {% for a in accounts %}
        <option value="{{ a.child_name }}">{{ a.child_name }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary mt-2">查詢</button>
</form>

{% if grouped_results %}
    {% for group in grouped_results %}
        <h4 class="mt-3">測驗批次</h4>
        <p><strong>正確率：</strong> {{ group.accuracy }} %</p>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>時間</th>
                    <th>關卡</th>
                    <th>小朋友選擇</th>
                    <th>系統判定</th>
                </tr>
            </thead>
            <tbody>
                {% for r in group.records %}
                <tr>
                    <td>{{ r.test_datetime }}</td>
                    <td>{{ r.stage }}</td>
                    <td>{{ r.child_choice }}</td>
                    <td>{{ r.system_result }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endfor %}
{% endif %}
{% endblock %}